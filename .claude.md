# Parseltongue Development Rules

## THE ABSOLUTE TOP: Core Philosophy

### FUNCTIONAL IDIOMATIC RUST
Write **pure functional code** following Rust idioms:
- ‚úÖ Prefer iterators over loops
- ‚úÖ Use `Result<T, E>` and `Option<T>` - never panic in libraries
- ‚úÖ Pure functions (no side effects unless explicit)
- ‚úÖ Immutability by default (`let` not `let mut`)
- ‚úÖ Trait-based abstractions (dependency injection)
- ‚úÖ RAII resource management (Drop trait)

### TDD-FIRST: STUB ‚Üí RED ‚Üí GREEN ‚Üí REFACTOR
**ALWAYS write tests BEFORE implementation:**
1. **STUB**: Write failing test with expected interface
2. **RED**: Run test, verify it fails correctly
3. **GREEN**: Minimal implementation to make test pass
4. **REFACTOR**: Improve code without breaking tests

### EXECUTABLE SPECIFICATIONS OVER NARRATIVES
Traditional user stories fail LLMs. Use **formal contracts**:
- **Preconditions**: What must be true before execution
- **Postconditions**: What will be true after execution
- **Error conditions**: What failures can occur
- **Performance claims**: Measured, not guessed

**Every claim validated by automated tests.**

---

## Rule #1: FOUR-WORD NAMING CONVENTION

**ALL function names: EXACTLY 4 words** (underscores separate)
**ALL crate names: EXACTLY 4 words** (hyphens separate)

**Why**: LLMs parse by tokenizing. 4 words = optimal semantic density.

```rust
‚úÖ filter_implementation_entities_only()
‚úÖ render_box_with_title_unicode()
‚úÖ save_visualization_output_to_file()
‚úÖ pt01-folder-to-cozodb-streamer

‚ùå filter_entities()                    // Too short (2)
‚ùå detect_cycles_in_dependency_graph()  // Too long (5)
```

**Naming pattern**: `verb_constraint_target_qualifier()`
- Verb: `filter`, `render`, `detect`, `save`
- Constraint: `implementation`, `box_with_title`, `visualization_output`
- Target: `entities`, `unicode`, `file`
- Qualifier: `only`, `to`, `in`

---

## Rule #2: NEVER LIE - Verify Everything

**Forbidden** (causes hallucination):
- ‚ùå Claiming "done" when not tested
- ‚ùå Saying tests pass without showing output
- ‚ùå Marking todos complete without verification
- ‚ùå Making up results

**Required**:
- ‚úÖ Run tests ‚Üí Show actual output
- ‚úÖ Build code ‚Üí Show actual output
- ‚úÖ Mark work complete ONLY after verification
- ‚úÖ Use explicit status: "‚úÖ VERIFIED" / "‚ö†Ô∏è UNTESTED" / "‚ùå BROKEN"

---

## Rule #3: NO STUBS IN COMMITS

**Every commit must be production-ready.**

**Forbidden**:
- ‚ùå Committing code with `TODO:` comments
- ‚ùå Committing `unimplemented!()` or `panic!()`
- ‚ùå Shipping releases with stubs
- ‚ùå Open todos in version control

**Required**:
- ‚úÖ Either implement FULLY or DON'T commit
- ‚úÖ Remove ALL todos before commit
- ‚úÖ If incomplete: Say "Cannot complete because [reason]"

---

## Rule #4: Layered Architecture (L1‚ÜíL2‚ÜíL3)

**L1 Core** (no_std compatible):
- Ownership, lifetimes, traits, Result/Option, RAII, newtype pattern

**L2 Standard**:
- Collections, iterators, smart pointers, Send/Sync

**L3 External**:
- Async/await (Tokio), serialization (Serde), databases (CozoDB)

**Never mix layers** - L3 cannot be in L1 core.

---

## Rule #5: Mermaid-Only Diagrams

ALL diagrams must be Mermaid (for GitHub rendering).
- ‚úÖ `graph LR`, `sequenceDiagram`, `classDiagram`
- ‚ùå No ASCII art, no image files, no external tools

---

## Enforcement Checklist

Before ANY commit:
- [ ] Tests written FIRST (TDD cycle)?
- [ ] Tests passing? (show output: `cargo test`)
- [ ] Build passing? (show output: `cargo build --release`)
- [ ] Zero TODOs/STUBs? (show: `grep -r "TODO\|STUB\|PLACEHOLDER"`)
- [ ] All function names = 4 words? (count: `verb_noun_noun_qualifier`)
- [ ] Follows functional idioms? (iterators, immutability, pure functions)
- [ ] Status verified? (not claimed without proof)

**If ANY checkbox unchecked ‚Üí STOP. NOT READY.**

---

## Quick Reference

**TDD Cycle**: STUB (write test) ‚Üí RED (fails) ‚Üí GREEN (minimal impl) ‚Üí REFACTOR (improve)

**Naming**: 4 words always (`action_constraint_target_qualifier`)

**Status markers**:
- ‚úÖ VERIFIED (ran tests, saw output)
- ‚ö†Ô∏è UNTESTED (needs testing)
- üöß INCOMPLETE (missing parts)
- ‚ùå BROKEN (not working)

**Architecture**: L1 (core) ‚Üí L2 (std) ‚Üí L3 (external)

**Never**: Stubs in commits, lies about status, non-4-word names, panic in libraries

**Always**: Tests first, functional style, immutability, proof over claims
