# Agent Games 2025 - Session Journal
**Date:** 2025-11-03
**Branch:** agent-games-2025

## Session Vision & Goals

### Core Problem Statement
**Parseltongue is underutilized.** Developers are using file exploration agents when they should be using parseltongue, leading to:
- Excessive LLM API costs
- Token waste (both context and generation)
- Loss of efficiency

### High-Leverage Solution
**Use parseltongue as much as possible** - it's the most efficient path for code analysis.

---

## Session Objectives

### 1. Extend Parseltongue Capabilities
- **Current levels:** level 0, level 1, level 2
- **Explore:** level 3, level 4, or perhaps level 1A/1B variations
- **Question:** What additional analysis layers would maximize value?

### 2. Investigate CPD Integration
- Search for CPD research document in our folders
- Understand how CPD enriches code analysis
- Plan integration strategy

### 3. ast-grep Deep Dive
- **Hypothesis:** ast-grep + parseltongue = deadly combination
- **Approach:**
  - Clone ast-grep into `.ref/ast-grep` (add to .gitignore)
  - Run pt02-level00 on ast-grep itself (meta-analysis!)
  - Understand what ast-grep actually does
  - Research alternatives and best graph methods

### 4. Research Phase
- What tools are similar to ASTGraph?
- What are the best graph analysis methods for code?
- GitHub code search for relevant approaches

---

## Key Insights So Far

### The Parseltongue Efficiency Principle
> "Stop exploring, start analyzing with parseltongue"

Traditional approach:
```
Agent explores files â†’ Reads code â†’ LLM analyzes â†’ Repeat
(High cost, high tokens, low efficiency)
```

Parseltongue approach:
```
Index once â†’ Query efficiently â†’ LLM enriches strategically
(Low cost, low tokens, high efficiency)
```

---

## Action Items & Progress

- [ ] Set up .ref infrastructure
- [ ] Clone and analyze ast-grep
- [ ] Find CPD research
- [ ] Research graph analysis landscape
- [ ] Design level 3/4 capabilities

---

## Notes & Discoveries

### âœ… CPG Research Found!

**Location:** `zzArchive202510/v0.8.8-docs/v090scope.md` (comprehensive 2120-line document!)

**Key Findings:**

#### 1. CPG (Code Property Graph) Definition
- **CPG** = AST + CFG + DFG + PDG unified representation
- Current parseltongue (ISG) = AST-focused with dependency edges
- **Future enhancement:** Extend to full CPG for deeper analysis

#### 2. Research Validation (2024 Papers)
- **Vul-LMGNN** (April 2024): CPG achieves ~10% higher F1 scores vs single-graph approaches
- **VulMPFF** (March 2024): Heterogeneous graph with 4 semantic relations
- **GraphFVD** (Jan 2025): Rust safety analysis with CPG

#### 3. v0.9.0 Roadmap
Three-pillar evolution documented:
- **PT07:** Analytics Dashboard (blast radius, complexity, coverage)
- **PT08:** Semantic Aggregation (clustering, modernity signatures)
- **PT11:** Journey-Aware Compression (task-specific context)

#### 4. Level 3/4 Possibilities
From the research, potential additions:
- **Level 3 (CPG):** Add CFG/DFG edges to DependencyEdges table
- **Level 4 (Semantic):** Pattern detection, layer analysis, provenance
- **Level 1A/1B:** Block-level entities (if/loop/match blocks) vs function-level

### âœ… ast-grep Analysis Complete

**Indexed:** 123 Rust files, 2163 entities, 860 dependency edges
**Output:**
- Level 00: `.ref/ast-grep-level00.json` (~5K tokens, pure edge list)
- Level 01: `.ref/ast-grep-level01-sigs.json` (~30K tokens, signatures only)

#### What is ast-grep?
**"Syntax-aware grep/sed"** - Fast, multi-language AST-based pattern matching tool

**Key Capabilities:**
- Pattern syntax that looks like code: `$A && $A()` â†’ `$A?.()`
- 20+ languages via tree-sitter (same foundation as parseltongue!)
- Multi-threaded Rust implementation (blazing fast)
- Embeddable library (Node.js, Python, Rust APIs)
- Linting framework + MCP server for AI assistants

**Philosophy:** Patterns are isomorphic to code (no complex DSL)

#### ast-grep vs parseltongue: Highly Complementary!

**What ast-grep has that parseltongue doesn't:**
- User-friendly pattern syntax (lower barrier to entry)
- Direct code rewriting (immediate transformations)
- Embeddable library APIs
- Linting framework
- MCP server for AI integration

**What parseltongue has that ast-grep doesn't:**
- âœ… **Interface Signature Graph (ISG)** - unique innovation!
- âœ… **Progressive Disclosure** - 100Ã— token reduction for LLMs
- âœ… **Temporal Versioning** - safe multi-step workflows
- âœ… **Graph Database (CozoDB)** - complex relational queries
- âœ… **Dependency Edge Export** - architectural analysis
- âœ… **Blast Radius Analysis** - impact assessment

#### Integration Opportunities ðŸŽ¯

**Scenario 1:** ast-grep as user interface to parseltongue ISG
- User writes intuitive patterns
- parseltongue provides graph context + dependencies

**Scenario 2:** Two-stage pipeline
- ast-grep: Fast pattern search (narrow scope)
- parseltongue: Graph analysis (rich context)

**Scenario 3:** Combined workflow
- ast-grep: Find and rewrite patterns
- parseltongue: Track changes, validate, compute blast radius

**Proposed Tool:** `pt07-pattern-search` (ast-grep-style patterns + ISG power)

### Similar Tools Research

**AST Pattern Matching:**
- **Semgrep:** Security-focused, semantic awareness
- **CodeQL:** Deep analysis, complex QL DSL, slower
- **Comby:** Language-agnostic, no semantic understanding

**Graph-Based Analysis:**
- **Joern:** Production CPG tool (C/C++/Java/Python)
- **Neo4j solutions:** Multiple code KG implementations
- **Graph4Code:** Web-scale (1.3M repos, 1.98B edges)

**Key Insight:** CPG = AST + CFG + DFG + PDG unified graph
â†’ This is the path for parseltongue Level 3/4!

---

## Session Summary

### What We Accomplished Today

**1. Infrastructure Setup âœ…**
- Created `.ref/` folder for reference repos (gitignored)
- Cloned ast-grep repository for analysis
- Copied parseltongue binary to root for easy access

**2. CPG Research Discovery âœ…**
- Found comprehensive v0.9.0 research (2120 lines!)
- Understood **CPG = AST + CFG + DFG + PDG** (Code Property Graph)
- Identified clear path for Level 3/4 enhancements
- 2024 academic validation: CPG gives 10% better results

**3. ast-grep Analysis âœ…**
- Indexed ast-grep itself using parseltongue (meta-analysis!)
- 123 Rust files â†’ 2163 entities â†’ 860 dependency edges
- Generated Level 00 (5K tokens) and Level 01 (30K tokens) exports
- Proved parseltongue can analyze major production tools

**4. Comprehensive Tool Research âœ…**
- Compared ast-grep, semgrep, CodeQL, Comby, Joern
- Discovered ast-grep + parseltongue = highly complementary
- Found integration opportunities (MCP server, pattern search)
- Identified parseltongue's unique strengths (ISG, progressive disclosure)

**5. Agent Games 2025 Vision âœ…**
- Core thesis: **Parseltongue minimizes LLM API costs** (100Ã— reduction)
- Traditional agents: 500K+ tokens per exploration
- Parseltongue agents: 2-5K tokens via ISG queries
- **Next step: CPU Avengers** - agents that maximize CPU work, minimize LLM calls

### Key Numbers
- **Token efficiency:** 2-5K (Level 0) vs 500K+ (file exploration) = **100Ã— savings**
- **ast-grep indexed:** 123 files, 2163 entities in 435ms
- **Research found:** 2120 lines of v0.9.0 planning with 26 citations

### The Big Idea
**CPU Avengers** - Create agents that use parseltongue + grep + glob (CPU-based tools) to research codebases WITHOUT spawning expensive LLM agents. Generate research markdown documents with ZERO LLM API calls during analysis phase.

