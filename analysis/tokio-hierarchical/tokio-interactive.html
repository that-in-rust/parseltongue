<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tokio Architecture - Interactive</title>
    <script src="https://unpkg.com/cytoscape@3.26.0/dist/cytoscape.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f5f5;
        }
        #header {
            background: #333;
            color: white;
            padding: 10px;
            text-align: center;
        }
        #cy {
            width: 100%;
            height: calc(100vh - 60px);
            background: white;
            border: 1px solid #ccc;
        }
        .controls {
            padding: 10px;
            background: #f0f0f0;
            border-bottom: 1px solid #ccc;
        }
        button {
            margin: 5px;
            padding: 5px 10px;
            cursor: pointer;
        }
        input {
            padding: 5px;
            margin: 5px;
            width: 200px;
        }
    </style>
</head>
<body>
    <div id="header">
        <h1>üêç Tokio Architecture - Interactive ISG Visualization</h1>
    </div>
    <div class="controls">
        <input type="text" id="search" placeholder="Search nodes..." />
        <button onclick="search()">Search</button>
        <button onclick="reset()">Reset View</button>
        <button onclick="fit()">Fit to Screen</button>
        <span id="status">Ready</span>
    </div>
    <div id="cy"></div>

    <script>
        // Simple test data
        const graphData = {
            nodes: [
                {data: {id: 'tokio', label: 'üöÄ tokio', type: 'crate', file: 'root'}},
                {data: {id: 'runtime', label: '‚ö° runtime', type: 'module', file: 'tokio/src/runtime'}},
                {data: {id: 'io', label: 'üíæ io', type: 'module', file: 'tokio/src/io'}},
                {data: {id: 'net', label: 'üåê net', type: 'module', file: 'tokio/src/net'}},
                {data: {id: 'sync', label: 'üîí sync', type: 'module', file: 'tokio/src/sync'}},
                {data: {id: 'util', label: 'üõ†Ô∏è util', type: 'module', file: 'tokio/src/util'}},
                {data: {id: 'macros', label: 'üìù macros', type: 'module', file: 'tokio/macros'}},
                {data: {id: 'test', label: 'üß™ test', type: 'module', file: 'tokio/test'}},
                {data: {id: 'AsyncRead', label: 'üìñ AsyncRead', type: 'trait', file: 'tokio/src/io'}},
                {data: {id: 'AsyncWrite', label: '‚úçÔ∏è AsyncWrite', type: 'trait', file: 'tokio/src/io'}},
                {data: {id: 'File', label: 'üìÑ File', type: 'struct', file: 'tokio/src/io'}},
                {data: {id: 'TcpStream', label: 'üîå TcpStream', type: 'struct', file: 'tokio/src/net'}},
                {data: {id: 'Mutex', label: 'üîê Mutex', type: 'struct', file: 'tokio/src/sync'}},
            ],
            edges: [
                {data: {source: 'tokio', target: 'runtime'}},
                {data: {source: 'tokio', target: 'io'}},
                {data: {source: 'tokio', target: 'net'}},
                {data: {source: 'tokio', target: 'sync'}},
                {data: {source: 'tokio', target: 'util'}},
                {data: {source: 'tokio', target: 'macros'}},
                {data: {source: 'tokio', target: 'test'}},
                {data: {source: 'io', target: 'AsyncRead'}},
                {data: {source: 'io', target: 'AsyncWrite'}},
                {data: {source: 'io', target: 'File'}},
                {data: {source: 'net', target: 'TcpStream'}},
                {data: {source: 'sync', target: 'Mutex'}},
                {data: {source: 'File', target: 'AsyncRead'}},
                {data: {source: 'File', target: 'AsyncWrite'}},
                {data: {source: 'TcpStream', target: 'AsyncRead'}},
                {data: {source: 'TcpStream', target: 'AsyncWrite'}},
            ]
        };

        let cy;

        function initCytoscape() {
            cy = cytoscape({
                container: document.getElementById('cy'),
                elements: graphData.nodes.concat(graphData.edges),
                style: [
                    {
                        selector: 'node',
                        style: {
                            'background-color': '#e1f5fe',
                            'border-color': '#0277bd',
                            'border-width': 2,
                            'color': '#01579b',
                            'label': 'data(label)',
                            'text-valign': 'center',
                            'text-halign': 'center',
                            'width': 80,
                            'height': 80,
                            'font-size': 12,
                            'text-outline-color': 'white',
                            'text-outline-width': 2,
                            'text-wrap': 'wrap',
                            'text-max-width': 80,
                            'overlay-padding': 4,
                            'z-index': 10
                        }
                    },
                    {
                        selector: 'edge',
                        style: {
                            'width': 2,
                            'line-color': '#666',
                            'target-arrow-color': '#666',
                            'target-arrow-shape': 'triangle',
                            'curve-style': 'bezier',
                            'opacity': 0.6
                        }
                    },
                    {
                        selector: 'node:selected',
                        style: {
                            'background-color': '#ffeb3b',
                            'border-color': '#f57c00',
                            'border-width': 3
                        }
                    }
                ],
                layout: {
                    name: 'cose',
                    idealEdgeLength: 100,
                    nodeOverlap: 20,
                    refresh: 20,
                    fit: true,
                    padding: 50,
                    randomize: false,
                    componentSpacing: 100,
                    nodeRepulsion: 400000,
                    edgeElasticity: 100,
                    nestingFactor: 5,
                    gravity: 80,
                    numIter: 1000,
                    initialTemp: 200,
                    coolingFactor: 0.95,
                    minTemp: 1.0
                }
            });

            // Add node click handlers
            cy.on('tap', 'node', function(evt) {
                const node = evt.target;
                const data = node.data();
                document.getElementById('status').innerHTML =
                    `Selected: ${data.label} (${data.type}) - ${data.file}`;
            });

            // Add edge click handlers
            cy.on('tap', 'edge', function(evt) {
                const edge = evt.target;
                const source = edge.source().data().label;
                const target = edge.target().data().label;
                document.getElementById('status').innerHTML =
                    `Connection: ${source} ‚Üí ${target}`;
            });

            // Background click to deselect
            cy.on('tap', function(event) {
                if (event.target === cy) {
                    cy.elements().unselect();
                    document.getElementById('status').innerHTML = 'Ready';
                }
            });

            document.getElementById('status').innerHTML =
                `Loaded ${graphData.nodes.length} nodes, ${graphData.edges.length} edges`;
        }

        function search() {
            const query = document.getElementById('search').value.toLowerCase();
            if (!query) {
                cy.elements().unselect();
                document.getElementById('status').innerHTML = 'Search cleared';
                return;
            }

            cy.elements().unselect();
            const matches = cy.nodes().filter(node =>
                node.data('label').toLowerCase().includes(query) ||
                node.data('type').toLowerCase().includes(query) ||
                node.data('file').toLowerCase().includes(query)
            );

            if (matches.length > 0) {
                matches.select();
                cy.fit(matches);
                document.getElementById('status').innerHTML =
                    `Found ${matches.length} matches for "${query}"`;
            } else {
                document.getElementById('status').innerHTML =
                    `No matches found for "${query}"`;
            }
        }

        function reset() {
            cy.elements().unselect();
            document.getElementById('search').value = '';
            document.getElementById('status').innerHTML = 'View reset';
        }

        function fit() {
            cy.fit();
            document.getElementById('status').innerHTML = 'Fitted to screen';
        }

        // Search on Enter key
        document.getElementById('search').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                search();
            }
        });

        // Initialize when page loads
        window.addEventListener('load', initCytoscape);
    </script>
</body>
</html>