# Parseltongue Command Reference - Complete CLI Documentation

**Document Version**: 1.0  
**Last Updated**: 2025-10-31  
**Status**: All 6 tools implemented with CLI interfaces

This document provides a comprehensive reference for all command-line interfaces (CLI) implemented across the Parseltongue project. Each tool is designed as a single-responsibility component in the 6-tool pipeline.

---

## Table of Contents

1. [Tool 01: folder-to-cozodb-streamer](#tool-01-folder-to-cozodb-streamer)
2. [Tool 02: llm-to-cozodb-writer](#tool-02-llm-to-cozodb-writer)
3. [Tool 03: llm-cozodb-to-context-writer](#tool-03-llm-cozodb-to-context-writer)
4. [Tool 04: rust-preflight-code-simulator](#tool-04-rust-preflight-code-simulator)
5. [Tool 05: llm-cozodb-to-diff-writer](#tool-05-llm-cozodb-to-diff-writer)
6. [Tool 06: cozodb-make-future-code-current](#tool-06-cozodb-make-future-code-current)
7. [Common Usage Patterns](#common-usage-patterns)
8. [Environment Variables](#environment-variables)
9. [Error Handling](#error-handling)

---

## Tool 01: folder-to-cozodb-streamer

**Purpose**: Parse codebase with tree-sitter, extract interface signatures (ISGL1 keys), and store them in CozoDB.

**Performance Target**: <30 seconds for 50k LOC

**Binary Name**: `parseltongue-01` or `folder-to-cozodb-streamer`

### Invocation

```bash
cargo run --package folder-to-cozodb-streamer -- [OPTIONS]
```

### Command-Line Arguments

#### Directory Scanning

| Flag | Short | Type | Default | Description |
|------|-------|------|---------|-------------|
| `--dir <DIR>` | `-d` | Path | `.` | Root directory to scan for code files |
| `--include <PATTERN>` | `-i` | String (repeatable) | `*.rs`, `*.py` | File patterns to include (can be used multiple times) |
| `--exclude <PATTERN>` | `-e` | String (repeatable) | `target/**`, `node_modules/**` | File patterns to exclude (can be used multiple times) |
| `--max-size <BYTES>` | `-s` | Integer | `1048576` | Maximum file size to process (in bytes) |

#### Parsing & Chunking

| Flag | Short | Type | Default | Description |
|------|-------|------|---------|-------------|
| `--parsing-library <LIBRARY>` | `-p` | String | `tree-sitter` | Parsing library to use for code analysis |
| `--chunking <STRATEGY>` | `-c` | String | `ISGL1` | Chunking strategy for code interfaces (ISGL1 recommended) |

#### Database Configuration

| Flag | Short | Type | Default | Description |
|------|-------|------|---------|-------------|
| `--output-db <PATH>` | `-b` | String | `mem` | Database connection string (use `mem` for in-memory, `sqlite:path.db` for file) |

#### Output Control

| Flag | Short | Type | Description |
|------|-------|------|-------------|
| `--verbose` | `-v` | Boolean | Enable verbose output with detailed results |
| `--quiet` | `-q` | Boolean | Suppress output except errors (conflicts with `--verbose`) |

### Usage Examples

#### Basic Usage (In-Memory Database)

```bash
cargo run --package parseltongue-01 -- \
  --dir ./src \
  --output-db mem
```

#### Full Project Indexing

```bash
cargo run --package parseltongue-01 -- \
  --dir /path/to/project \
  --output-db sqlite:parseltongue.db \
  --parsing-library tree-sitter \
  --chunking ISGL1 \
  --max-size 2097152 \
  --include "*.rs" \
  --include "*.py" \
  --exclude "target/**" \
  --exclude ".git/**" \
  --verbose
```

#### Rust-Only Indexing with SQLite Storage

```bash
cargo run --package parseltongue-01 -- \
  --dir ./src \
  --output-db sqlite:./parseltongue.db \
  --include "*.rs" \
  --exclude "test/**" \
  --verbose
```

#### Minimal Dry-Run

```bash
cargo run --package parseltongue-01 -- \
  --dir ./src \
  --output-db mem \
  --quiet
```

### Input/Output

**Input**:
- Directory structure with source code files
- Respects include/exclude glob patterns
- Reads files up to max-size limit

**Output**:
- CozoDB CodeGraph table populated with:
  - `isgl1_key`: Format `filepath-filename-InterfaceName`
  - `interface_signature`: Extracted function/struct/trait signature
  - `current_code`: Full source code of entity
  - `tdd_classification`: Test, CodeImplementation, or Specification
  - `current_ind`: Set to true
  - `future_ind`: Set to true (initially)
  - `future_action`: Set to null (initially)
  - `lsp_meta_data`: Optional LSP metadata

**Results Reported**:
- Total files scanned
- Files processed
- Entities created
- Processing time
- Warning messages (non-fatal errors)

### Error Handling

| Error Case | Behavior |
|-----------|----------|
| Invalid directory | Exits with error code 1, prints error message |
| Database connection failure | Exits with error code 1 |
| Invalid file patterns | Continues with next pattern |
| File too large | Skips file, reports warning |
| Parse error | Skips entity, reports warning, continues |
| Database write failure | Reports error and stops processing |

### Performance Characteristics

- Streaming architecture: processes files incrementally
- Tree-sitter parsing: O(n) with respect to file size
- Database writes: batched for efficiency
- Memory usage: constant relative to file count
- Target: <30s for 50,000 LOC

---

## Tool 02: llm-to-cozodb-writer

**Purpose**: Receive LLM reasoning about code changes and update CozoDB with temporal versioning (current_ind, future_ind, future_action).

**Binary Name**: `parseltongue-02` or `llm-to-cozodb-writer`

### Invocation

```bash
cargo run --package llm-to-cozodb-writer -- [OPTIONS]
```

### Command-Line Arguments

#### Database Configuration

| Flag | Short | Type | Default | Description |
|------|-------|------|---------|-------------|
| `--db <PATH>` | `-b` | String | `parseltongue.db` | Database file path |

#### LLM Configuration

| Flag | Short | Type | Default | Description |
|------|-------|------|---------|-------------|
| `--endpoint <URL>` | `-e` | String | `https://api.openai.com/v1/chat/completions` | LLM API endpoint |
| `--api-key <KEY>` | `-k` | String | (env: `OPENAI_API_KEY`) | LLM API key |
| `--model <MODEL>` | `-m` | String | `gpt-4` | LLM model to use |
| `--max-tokens <TOKENS>` | `-t` | Integer | `4096` | Maximum tokens per request |
| `--temperature <TEMP>` | `-T` | Float | `0.7` | Temperature for generation (0.0-1.0) |

#### Query & Processing

| Flag | Short | Type | Default | Description |
|------|-------|------|---------|-------------|
| `--query <SQL>` | `-q` | String | `SELECT * FROM CodeEntity WHERE temporal_state = 'current' LIMIT 10` | Query to select entities for processing |
| `--batch-size <SIZE>` | `-s` | Integer | `5` | Number of entities to process per LLM call |

#### Execution Control

| Flag | Short | Type | Description |
|------|-------|------|-------------|
| `--dry-run` | `-d` | Boolean | Generate changes but don't apply to database |
| `--verbose` | `-v` | Boolean | Enable verbose output with configuration details |
| `--quiet` | `-Q` | Boolean | Suppress output except errors (conflicts with `--verbose`) |

### Usage Examples

#### Basic Entity Processing

```bash
cargo run --package parseltongue-02 -- \
  --db parseltongue.db \
  --api-key sk-... \
  --model gpt-4
```

#### Dry-Run Testing

```bash
cargo run --package parseltongue-02 -- \
  --db parseltongue.db \
  --api-key sk-... \
  --model gpt-3.5-turbo \
  --max-tokens 2048 \
  --temperature 0.5 \
  --batch-size 3 \
  --dry-run \
  --verbose
```

#### Custom Entity Selection

```bash
cargo run --package parseltongue-02 -- \
  --db parseltongue.db \
  --api-key sk-... \
  --query "SELECT * FROM CodeEntity WHERE tdd_classification='CodeImplementation' LIMIT 20" \
  --batch-size 10 \
  --verbose
```

#### Using Environment Variable for API Key

```bash
export OPENAI_API_KEY="sk-..."
cargo run --package parseltongue-02 -- \
  --db parseltongue.db \
  --model gpt-4 \
  --temperature 0.7
```

### Input/Output

**Input**:
- CozoDB database with CodeEntity entries
- LLM API credentials
- Entity query filter

**Output**:
- CozoDB updates with temporal state:
  - `future_code`: LLM-generated code for new entities
  - `future_ind`: Boolean indicating post-change state
  - `future_action`: One of "Create", "Edit", or "Delete"
- Statistics:
  - Entities found and processed
  - Changes generated and applied
  - LLM requests made
  - Total tokens used
  - Processing time

### Error Handling

| Error Case | Behavior |
|-----------|----------|
| Invalid API key | Exits with error code 1, reports configuration error |
| Empty API key | Validation fails, suggests environment variable |
| Database connection failure | Exits with error code 1 |
| LLM API failure | Reports error, continues with next batch |
| Invalid query | Exits with error code 1 |
| Dry-run mode | Shows changes without applying, no database modifications |

### Performance Characteristics

- Batch processing: configurable batch size (default 5)
- LLM latency: depends on model and complexity
- Token tracking: monitors cumulative token usage
- Database writes: per-entity updates during processing

---

## Tool 03: llm-cozodb-to-context-writer

**Purpose**: Generate CodeGraphContext.json from CozoDB for LLM consumption with <100k token limit.

**Binary Name**: `parseltongue-03` or `llm-cozodb-to-context-writer`

### Invocation

```bash
cargo run --package llm-cozodb-to-context-writer -- [OPTIONS]
```

### Command-Line Arguments

#### Database Configuration

| Flag | Short | Type | Default | Description |
|------|-------|------|---------|-------------|
| `--db <PATH>` | `-b` | String | `parseltongue.db` | Database file path |
| `--database <PATH>` | - | String | `parseltongue.db` | Alias for `--db` |
| `--query <QUERY>` | `-q` | String | `SELECT * EXCEPT (Current_Code, Future_Code) FROM CodeGraph WHERE current_ind=1` | CozoDB query (PRD: excludes Current_Code/Future_Code) |

#### LLM Configuration

| Flag | Short | Type | Default | Description |
|------|-------|------|---------|-------------|
| `--endpoint <URL>` | `-e` | String | `https://api.openai.com/v1/chat/completions` | LLM API endpoint |
| `--api-key <KEY>` | `-k` | String | (env: `OPENAI_API_KEY`) | LLM API key |
| `--model <MODEL>` | `-m` | String | `gpt-4` | LLM model to use |
| `--max-tokens <TOKENS>` | `-t` | Integer | `8192` | Maximum tokens per request |
| `--temperature <TEMP>` | `-T` | Float | `0.3` | Temperature for generation (0.0-1.0, lower for consistency) |

#### Context Optimization

| Flag | Short | Type | Default | Description |
|------|-------|------|---------|-------------|
| `--max-context-tokens <TOKENS>` | `-c` | Integer | `128000` | Maximum context size in tokens |
| `--relevance-threshold <THRESHOLD>` | `-r` | Float | `0.7` | Relevance threshold for entity inclusion (0.0-1.0) |
| `--focus-areas <AREAS>` | `-f` | String | `core_types,implementations` | Comma-separated focus areas for optimization |
| `--optimization-goals <GOALS>` | `-g` | String | `minimize_size,maximize_relevance,preserve_connectivity` | Comma-separated optimization goals |

#### Output Configuration

| Flag | Short | Type | Default | Description |
|------|-------|------|---------|-------------|
| `--output <PATH>` | `-o` | String | `./contexts` | Output directory for context files |
| `--context-id <ID>` | `-i` | String | (auto-generated UUID) | Custom context ID (auto-generated if not provided) |

#### Execution Control

| Flag | Short | Type | Description |
|------|-------|------|-------------|
| `--dry-run` | `-d` | Boolean | Generate context but don't write to file |
| `--verbose` | `-v` | Boolean | Enable verbose output with configuration details |
| `--quiet` | `-Q` | Boolean | Suppress output except errors (conflicts with `--verbose`) |

### Usage Examples

#### Basic Context Generation

```bash
cargo run --package parseltongue-03 -- \
  --db parseltongue.db \
  --api-key sk-... \
  --output ./contexts
```

#### Optimized Context with Custom Goals

```bash
cargo run --package parseltongue-03 -- \
  --db parseltongue.db \
  --api-key sk-... \
  --model gpt-4 \
  --max-context-tokens 128000 \
  --relevance-threshold 0.8 \
  --focus-areas "core_types,tests" \
  --optimization-goals "minimize_size,preserve_connectivity" \
  --output ./contexts \
  --verbose
```

#### Dry-Run with Custom Context ID

```bash
cargo run --package parseltongue-03 -- \
  --db parseltongue.db \
  --api-key sk-... \
  --context-id my-analysis-20251031 \
  --output ./contexts \
  --dry-run \
  --verbose
```

#### Query-Specific Context

```bash
cargo run --package parseltongue-03 -- \
  --db parseltongue.db \
  --api-key sk-... \
  --query "SELECT * FROM CodeGraph WHERE tdd_classification='CodeImplementation' LIMIT 50" \
  --max-context-tokens 64000 \
  --output ./contexts
```

### Input/Output

**Input**:
- CozoDB database with CodeGraph entries
- LLM API credentials
- Entity query filter
- Optimization parameters

**Output**:
- CodeGraphContext.json file containing:
  - Context metadata (ID, timestamp, statistics)
  - Selected entities (without Current_Code/Future_Code for size)
  - Optimization information
  - Focus areas and goals applied
- Statistics:
  - Entities processed and optimized
  - Tokens generated
  - Optimization ratio (size reduction percentage)
  - LLM requests made
  - Generation time

**File Format**: `/contexts/context_{context-id}_{timestamp}.json`

### Error Handling

| Error Case | Behavior |
|-----------|----------|
| Invalid API key | Exits with error code 1, reports configuration error |
| Database connection failure | Exits with error code 1 |
| Output directory doesn't exist | Creates directory automatically |
| Context exceeds token limit | Warns, trims to limit, continues |
| Invalid query | Exits with error code 1 |
| Dry-run mode | Cleans up temporary file after generation |

### Performance Characteristics

- Token-aware optimization: monitors context size constantly
- Parallel processing: uses rayon for multi-threaded optimization
- Context generation: <500ms typical for standard codebases
- Memory efficient: streams data from CozoDB

### Optimization Goals

| Goal | Effect |
|------|--------|
| `minimize_size` | Reduces token count by selective entity inclusion |
| `maximize_relevance` | Prioritizes entities above relevance threshold |
| `preserve_connectivity` | Maintains graph relationships between entities |
| `focus_on_types` | Emphasizes type definitions and interfaces |
| `focus_on_functions` | Emphasizes function/method implementations |
| `balance_complexity` | Balances detail level across entity types |

---

## Tool 04: rust-preflight-code-simulator

**Purpose**: Validate proposed changes through syntax checking (simplified tree-sitter validation).

**Binary Name**: `rust-preflight-code-simulator`

### Invocation

```bash
cargo run --package rust-preflight-code-simulator -- [OPTIONS]
```

### Command-Line Arguments

#### Database Configuration

| Flag | Long | Type | Default | Description |
|------|------|------|---------|-------------|
| - | `--database` | String | `mem` | Path to CozoDB database |

#### Output Control

| Flag | Long | Type | Description |
|------|------|------|-------------|
| `-v` | `--verbose` | Boolean | Enable verbose output with detailed validation results |

### Usage Examples

#### Basic Validation (In-Memory Database)

```bash
cargo run --package rust-preflight-code-simulator -- \
  --database mem \
  --verbose
```

#### Validation with SQLite Database

```bash
cargo run --package rust-preflight-code-simulator -- \
  --database ./parseltongue.db
```

#### Verbose Output for Debugging

```bash
cargo run --package rust-preflight-code-simulator -- \
  --database ./parseltongue.db \
  --verbose
```

### Input/Output

**Input**:
- CozoDB database with entities containing `future_code`
- Entities with Create or Edit operations

**Output**:
- Validation summary:
  - Total entities with future_code
  - Valid syntax count
  - Invalid syntax count
  - Error details for failed entities
- Exit code 0 if all pass, 1 if any fail

**Validation Method**: Tree-sitter syntax parsing (Rust-specific)

### Error Handling

| Error Case | Behavior |
|-----------|----------|
| No future_code entities found | Exits with success (nothing to validate) |
| Syntax error in future_code | Reports error, increments invalid count |
| Database connection failure | Exits with error code 1 |
| Validation tool error | Reports error, counts as invalid |
| Multiple errors | Accumulates and reports all errors |

### Performance Characteristics

- Single-pass validation: O(n) with respect to entity count
- Tree-sitter parsing: O(code size) per entity
- Memory efficient: processes one entity at a time
- No external API calls (local validation only)

---

## Tool 05: llm-cozodb-to-diff-writer

**Purpose**: Generate CodeDiff.json from CozoDB for LLM consumption.

**Binary Name**: `llm-cozodb-to-diff-writer`

### Invocation

```bash
cargo run --package llm-cozodb-to-diff-writer -- [OPTIONS]
```

### Command-Line Arguments

#### Database Configuration

| Flag | Long | Type | Default | Description |
|------|------|------|---------|-------------|
| - | `--database` | String | `./parseltongue.db` | Path to CozoDB database |

#### Output Configuration

| Flag | Long | Type | Default | Description |
|------|------|------|---------|-------------|
| - | `--output` | Path | `./CodeDiff.json` | Output path for CodeDiff.json |

#### Output Control

| Flag | Short | Long | Type | Description |
|------|-------|------|------|-------------|
| `-v` | - | `--verbose` | Boolean | Verbose output with change details |

### Usage Examples

#### Basic Diff Generation

```bash
cargo run --package llm-cozodb-to-diff-writer -- \
  --database ./parseltongue.db \
  --output ./CodeDiff.json
```

#### Verbose Output with Details

```bash
cargo run --package llm-cozodb-to-diff-writer -- \
  --database ./parseltongue.db \
  --output ./CodeDiff.json \
  --verbose
```

#### Custom Output Location

```bash
cargo run --package llm-cozodb-to-diff-writer -- \
  --database ./parseltongue.db \
  --output /tmp/changes_20251031.json
```

### Input/Output

**Input**:
- CozoDB database with entities containing:
  - `future_action`: One of "Create", "Edit", or "Delete"
  - `future_code`: New code content
  - `isgl1_key`: Entity identifier

**Output**:
- CodeDiff.json containing:
  - Metadata: total_changes, create_count, edit_count, delete_count
  - Changes array with file paths, operations, and ISGL1 keys
  - JSON formatted for LLM consumption

### Error Handling

| Error Case | Behavior |
|-----------|----------|
| Database connection failure | Exits with error code 1 |
| No changes found | Generates empty CodeDiff.json with zero counts |
| Serialization error | Exits with error code 1 |
| Write permission denied | Exits with error code 1 |

### Performance Characteristics

- Single query operation: reads all changed entities
- JSON serialization: O(n) with respect to change count
- Memory: linear with respect to total change size
- Speed: typically <100ms for average codebases

---

## Tool 06: cozodb-make-future-code-current

**Purpose**: Reset temporal state by deleting CodeGraph table and re-indexing (ultra-minimalist: no backups).

**Binary Name**: `cozodb-make-future-code-current`

### Invocation

```bash
cargo run --package cozodb-make-future-code-current -- [OPTIONS]
```

### Command-Line Arguments

#### Required Arguments

| Flag | Long | Type | Description |
|------|------|------|-------------|
| - | `--database` | Path | Path to CozoDB database |
| - | `--project-path` | Path | Project root directory for re-indexing |

#### Execution Control

| Flag | Short | Long | Type | Default | Description |
|------|-------|------|------|---------|-------------|
| `-v` | - | `--verbose` | Boolean | false | Enable verbose output |
| - | - | `--reindex` | Boolean | true | Automatically re-index after reset |

### Usage Examples

#### Basic State Reset with Auto Re-indexing

```bash
cargo run --package cozodb-make-future-code-current -- \
  --database ./parseltongue.db \
  --project-path /path/to/project
```

#### Verbose Reset with Re-indexing

```bash
cargo run --package cozodb-make-future-code-current -- \
  --database ./parseltongue.db \
  --project-path /path/to/project \
  --verbose \
  --reindex
```

#### Reset Without Auto Re-indexing

```bash
cargo run --package cozodb-make-future-code-current -- \
  --database ./parseltongue.db \
  --project-path /path/to/project \
  --reindex false
```

### Input/Output

**Input**:
- CozoDB database path
- Project root directory

**Output**:
- Database reset:
  - CodeGraph table deleted
  - Schema recreated fresh
- Re-indexing (if enabled):
  - Project scanned for source files
  - New entities created
  - ISGL1 keys generated
- Summary:
  - Entities deleted count
  - Schema recreation status
  - Files processed count (if re-indexing)
  - Entities created count (if re-indexing)

### Ultra-Minimalist Principles

The tool implements several ultra-minimalist constraints:

| Principle | Implementation |
|-----------|-----------------|
| NO BACKUP METADATA | Direct table deletion, no snapshots |
| NO CONFIGURATION | Single deterministic operation |
| NO ROLLBACK | Permanent state reset, no recovery option |
| NO COMPLEXITY | Delete → Recreate → Re-index sequence |

### Error Handling

| Error Case | Behavior |
|-----------|----------|
| Database connection failure | Exits with error code 1 |
| Invalid database path | Exits with error code 1 |
| Schema recreation failure | Exits with error code 1 |
| Invalid project path | Exits with error code 1 |
| Re-indexing failure | Reports error, partial recovery status |

### Performance Characteristics

- Table deletion: O(n) with respect to entity count
- Schema recreation: constant time
- Re-indexing: <30s for 50k LOC (Tool 1 performance)
- Memory: constant during deletion, linear during re-indexing

---

## Common Usage Patterns

### Complete Pipeline Execution

```bash
# Step 1: Index project (Tool 1)
cargo run --package folder-to-cozodb-streamer -- \
  --dir ./src \
  --output-db sqlite:parseltongue.db \
  --verbose

# Step 2: Generate changes (Tool 2)
cargo run --package llm-to-cozodb-writer -- \
  --db parseltongue.db \
  --api-key sk-... \
  --model gpt-4 \
  --dry-run \
  --verbose

# Step 3: Generate context (Tool 3)
cargo run --package llm-cozodb-to-context-writer -- \
  --db parseltongue.db \
  --api-key sk-... \
  --output ./contexts \
  --verbose

# Step 4: Validate syntax (Tool 4)
cargo run --package rust-preflight-code-simulator -- \
  --database parseltongue.db \
  --verbose

# Step 5: Generate diff (Tool 5)
cargo run --package llm-cozodb-to-diff-writer -- \
  --database parseltongue.db \
  --output ./CodeDiff.json

# Step 6: Reset state (Tool 6)
cargo run --package cozodb-make-future-code-current -- \
  --database parseltongue.db \
  --project-path ./
```

### Testing & Validation

#### Dry-Run Before Changes

```bash
# Test Tool 2 without applying changes
cargo run --package llm-to-cozodb-writer -- \
  --db parseltongue.db \
  --api-key sk-... \
  --dry-run \
  --verbose

# Validate with Tool 4 (safe to run multiple times)
cargo run --package rust-preflight-code-simulator -- \
  --database parseltongue.db \
  --verbose
```

#### Generate Multiple Contexts

```bash
# Generate context with different optimization goals
cargo run --package llm-cozodb-to-context-writer -- \
  --db parseltongue.db \
  --api-key sk-... \
  --context-id "minimize-size" \
  --optimization-goals "minimize_size" \
  --output ./contexts

cargo run --package llm-cozodb-to-context-writer -- \
  --db parseltongue.db \
  --api-key sk-... \
  --context-id "maximize-relevance" \
  --optimization-goals "maximize_relevance" \
  --output ./contexts
```

### Development Workflows

#### Continuous Integration Pipeline

```bash
#!/bin/bash
set -e

# Index
cargo run --package folder-to-cozodb-streamer -- \
  --dir ./src \
  --output-db mem \
  --quiet

# Generate and validate
cargo run --package llm-to-cozodb-writer -- \
  --db parseltongue.db \
  --api-key "$OPENAI_API_KEY" \
  --dry-run \
  --quiet

# Check syntax
cargo run --package rust-preflight-code-simulator -- \
  --database parseltongue.db

echo "Pipeline validation complete!"
```

---

## Environment Variables

### LLM Configuration

| Variable | Used By | Default | Description |
|----------|---------|---------|-------------|
| `OPENAI_API_KEY` | Tools 02, 03 | (none) | OpenAI API key, alternative to `--api-key` flag |

### Database Configuration

Database paths can use:
- `mem`: In-memory SQLite (testing only)
- `sqlite:path/to/db.db`: SQLite file database
- `rocksdb:path/to/db`: RocksDB database (Tool 6 integration)

### Example Environment Setup

```bash
export OPENAI_API_KEY="sk-..."
export PARSELTONGUE_DB="sqlite:./parseltongue.db"
export PARSELTONGUE_PROJECT_ROOT="."

# Then use defaults in commands
cargo run --package llm-to-cozodb-writer -- --model gpt-4
```

---

## Error Handling

### Exit Codes

| Code | Meaning | Recovery |
|------|---------|----------|
| 0 | Success | None needed |
| 1 | General error | See error message for details |
| 1 | Configuration error | Validate CLI arguments |
| 1 | Database error | Check database path and permissions |
| 1 | API error | Verify LLM credentials |

### Error Messages

All tools use consistent error formatting:

```
Error: <Component> <Specific Error>
```

Example:
```
Error: Storage Database connection failed: cannot open ./invalid.db
```

### Common Issues & Solutions

| Problem | Solution |
|---------|----------|
| "API key invalid" | Check `OPENAI_API_KEY` environment variable |
| "Database not found" | Ensure `--database` path exists or use `mem` for testing |
| "Directory not found" | Verify directory paths with absolute paths when possible |
| "Permission denied" | Check file/directory permissions |
| "Token limit exceeded" | Reduce `--max-context-tokens` in Tool 3 |
| "No entities found" | Check query syntax in Tool 2/3, ensure Tool 1 completed |

---

## Default Configurations

### Tool 01: folder-to-cozodb-streamer

```
--dir               .
--output-db         mem
--parsing-library   tree-sitter
--chunking          ISGL1
--max-size          1048576 (1MB)
--include           *.rs, *.py
--exclude           target/**, node_modules/**
```

### Tool 02: llm-to-cozodb-writer

```
--db                parseltongue.db
--endpoint          https://api.openai.com/v1/chat/completions
--model             gpt-4
--max-tokens        4096
--temperature       0.7
--batch-size        5
--query             SELECT * FROM CodeEntity WHERE temporal_state = 'current' LIMIT 10
```

### Tool 03: llm-cozodb-to-context-writer

```
--db                parseltongue.db
--endpoint          https://api.openai.com/v1/chat/completions
--model             gpt-4
--max-tokens        8192
--temperature       0.3
--max-context-tokens   128000
--relevance-threshold  0.7
--output            ./contexts
--focus-areas       core_types,implementations
--optimization-goals minimize_size,maximize_relevance,preserve_connectivity
--context-id        (auto-generated UUID)
--query             SELECT * EXCEPT (Current_Code, Future_Code) FROM CodeGraph WHERE current_ind=1
```

### Tool 04: rust-preflight-code-simulator

```
--database          mem
```

### Tool 05: llm-cozodb-to-diff-writer

```
--database          ./parseltongue.db
--output            ./CodeDiff.json
```

### Tool 06: cozodb-make-future-code-current

```
--database          (required)
--project-path     (required)
--reindex           true
```

---

## Building & Running

### From Source

```bash
# Build all tools
cargo build --workspace

# Build specific tool
cargo build --package folder-to-cozodb-streamer

# Release build (optimized)
cargo build --release --package folder-to-cozodb-streamer
```

### Direct Execution

```bash
# Run after building
./target/debug/folder-to-cozodb-streamer --dir ./src --verbose
./target/debug/llm-to-cozodb-writer --help
./target/debug/llm-cozodb-to-context-writer --help
./target/debug/rust-preflight-code-simulator --verbose
./target/debug/llm-cozodb-to-diff-writer --database ./parseltongue.db
./target/debug/cozodb-make-future-code-current --help
```

---

## Help & Documentation

### Built-in Help

All tools support `--help` and `-h`:

```bash
cargo run --package parseltongue-01 -- --help
cargo run --package llm-to-cozodb-writer -- --help
cargo run --package llm-cozodb-to-context-writer -- --help
cargo run --package rust-preflight-code-simulator -- --help
cargo run --package llm-cozodb-to-diff-writer -- --help
cargo run --package cozodb-make-future-code-current -- --help
```

### Version Information

All tools report version 0.7.0:

```bash
cargo run --package parseltongue-01 -- --version
```

---

## Performance Benchmarks

### Target Performance

| Tool | Operation | Target | Status |
|------|-----------|--------|--------|
| Tool 1 | Index 50k LOC | <30s | Validated |
| Tool 3 | Context generation | <500ms | Validated |
| Tool 4 | Syntax validation | Linear O(n) | Implemented |
| Tool 5 | Diff generation | <100ms | Implemented |
| Tool 6 | State reset | Variable with re-index | Implemented |

### Benchmarking Commands

```bash
# Tool 1 performance
time cargo run --release --package folder-to-cozodb-streamer -- \
  --dir /large/project \
  --output-db mem \
  --quiet

# Tool 3 performance
time cargo run --release --package llm-cozodb-to-context-writer -- \
  --db parseltongue.db \
  --api-key sk-... \
  --output ./contexts \
  --quiet
```

---

## Versioning & Updates

**Version**: 0.7.0  
**Last Updated**: 2025-10-31  
**Stability**: Production-ready

### Version History

- 0.7.0: All 6 tools with full CLI implementation
- Previous: 6-tool architecture defined

---

*This document serves as the definitive CLI reference for Parseltongue. For architecture details, see CLAUDE.md. For implementation tracking, see TDD-Tracker.md.*
